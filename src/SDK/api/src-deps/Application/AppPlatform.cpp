#include "AppPlatform.h"

/*
    search "https://aka.ms/MCHelp" to find AppPlatform::getFeedbackHelpLink
*/

void AppPlatform::initialize() {
    // search "Streaming Pool" and find caller
    using Bind = sapphire::bind::Fn<
#if MC_VERSION == v1_21_2
        "\x48\x89\x5C\x24\x00\x48\x89\x74\x24\x00\x48\x89\x7C\x24\x00\x55\x41\x54\x41\x55\x41\x56\x41\x57\x48\x8D\x6C\x24\x00\x48\x81\xEC\x00\x00\x00\x00\x48\x8B\x05\x00\x00\x00\x00\x48\x33\xC4\x48\x89\x45\x00\x48\x8B\xF1\x45\x33\xF6"_sig,
#elif MC_VERSION == v1_21_50
        "\x48\x89\x5C\x24\x00\x48\x89\x74\x24\x00\x48\x89\x7C\x24\x00\x55\x41\x54\x41\x55\x41\x56\x41\x57\x48\x8D\xAC\x24\x00\x00\x00\x00\x48\x81\xEC\x00\x00\x00\x00\x48\x8B\x05\x00\x00\x00\x00\x48\x33\xC4\x48\x89\x85\x00\x00\x00\x00\x48\x8B\xF9\x45\x33\xE4\x45\x8D\x6C\x24"_sig,
#elif MC_VERSION == v1_21_60
        "\x48\x89\x5C\x24\x00\x48\x89\x74\x24\x00\x48\x89\x7C\x24\x00\x55\x41\x54\x41\x55\x41\x56\x41\x57\x48\x8D\xAC\x24\x00\x00\x00\x00\x48\x81\xEC\x00\x00\x00\x00\x48\x8B\x05\x00\x00\x00\x00\x48\x33\xC4\x48\x89\x85\x00\x00\x00\x00\x48\x8B\xF9\x45\x33\xED\x41\xBE"_sig,
#endif
        &AppPlatform::initialize>;
    (this->*Bind::origin)();
}

void AppPlatform::addListener(Listener *l, float priority) {
    using Bind = sapphire::bind::Fn<
#if MC_VERSION == v1_21_2
        "\x48\x89\x5C\x24\x00\x48\x89\x74\x24\x00\x57\x48\x83\xEC\x00\x0F\x29\x74\x24\x00\x0F\x28\xF2"_sig,
#elif MC_VERSION == v1_21_50 || MC_VERSION == v1_21_60
        "\x48\x89\x5C\x24\x00\x48\x89\x6C\x24\x00\x56\x57\x41\x56\x48\x83\xEC\x00\x0F\x29\x74\x24\x00\x0F\x28\xF2\x48\x8B\xEA\x48\x8B\xF1"_sig,
#endif
        &AppPlatform::addListener>;
    (this->*Bind::origin)(l, priority);
}

void AppPlatform::removeListener(Listener *l) {
    using Bind = sapphire::bind::Fn<
#if MC_VERSION == v1_21_2
        "\x48\x89\x5C\x24\x00\x48\x89\x74\x24\x00\x57\x48\x83\xEC\x00\x48\x8B\xF9\x48\x8B\xF2\x48\x81\xC1\x00\x00\x00\x00\xFF\x15\x00\x00\x00\x00\x85\xC0\x74\x00\x8B\xC8\xFF\x15\x00\x00\x00\x00\xCC\x48\x8B\x47"_sig,
#elif MC_VERSION == v1_21_50 || MC_VERSION == v1_21_60
        "\x48\x89\x5C\x24\x00\x48\x89\x74\x24\x00\x57\x48\x83\xEC\x00\x48\x8B\xF2\x48\x8B\xF9\x48\x81\xC1\x00\x00\x00\x00\xFF\x15\x00\x00\x00\x00\x85\xC0"_sig,
#endif
        &AppPlatform::removeListener>;
    (this->*Bind::origin)(l);
}

void AppPlatform::_fireAppSuspended() {
    using Bind = sapphire::bind::Fn<
        sapphire::deRefCall | "\xE9\x00\x00\x00\x00\xFF\x15\x00\x00\x00\x00\xCC\xCC\xCC\xCC\xC6\x41"_sig,
        &AppPlatform::_fireAppSuspended>;
    return (this->*Bind::origin)();
}

template <>
ServiceReference<AppPlatform> ServiceLocator<AppPlatform>::get() {
    using Bind = sapphire::bind::Fn<
#if MC_VERSION == v1_21_2
        sapphire::deRefCall | "\xE8\x00\x00\x00\x00\x90\x48\x8B\x8B\x00\x00\x00\x00\x48\x8B\x01\x48\x8B\x40"_sig,
#elif MC_VERSION == v1_21_50
        sapphire::deRefCall | "\xE8\x00\x00\x00\x00\x90\xC6\x45\x00\x00\x48\x8B\x8D\x00\x00\x00\x00\x48\x85\xC9\x74\x00\xF0\xFF\x41"_sig,
#elif MC_VERSION == v1_21_60
        sapphire::deRefCall | "\xE8\x00\x00\x00\x00\x90\x48\x8B\x8D\x00\x00\x00\x00\x48\x8B\x01\x48\x8B\x40\x00\xFF\x15\x00\x00\x00\x00\x48\x8B\xBC\x24"_sig,
#endif
        &ServiceLocator<AppPlatform>::get>;
    return Bind::origin();
}
