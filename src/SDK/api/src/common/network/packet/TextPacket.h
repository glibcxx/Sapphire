#pragma once

#include "../Packet.h"
#include "SDK/api/src-deps/Core/Utility/PrimitiveTypes.h"

enum class TextPacketType : byte {
    Raw = 0,
    Chat = 1,
    Translate = 2,
    Popup = 3,
    JukeboxPopup = 4,
    Tip = 5,
    SystemMessage = 6,
    Whisper = 7,
    Announcement = 8,
    TextObjectWhisper = 9,
    TextObject = 10,
    TextObjectAnnouncement = 11,
};

// size: 256
class TextPacket : public Packet {
public:
    TextPacketType             mType;            // off+48
    std::string                mAuthor;          // off+56
    std::string                mMessage;         // off+88
    std::optional<std::string> mFilteredMessage; // off+120
    std::vector<std::string>   params;           // off+160
    bool                       mLocalize;        // off+184
    std::string                mXuid;            // off+192
    std::string                mPlatformId;      // off+224

    // vtb+0
    virtual ~TextPacket() = default;

    // vtb+2
    virtual std::string getName() const override;

    // vtb+4
    virtual void write(BinaryStream &stream) const override;

    // vtb+8
    virtual Bedrock::Result<void> _read(ReadOnlyBinaryStream &stream) override;

    SPHR_DECL_API("v1_21_2", "\x48\x89\x5C\x24\x00\x48\x89\x74\x24\x00\x55\x57\x41\x56\x48\x8D\x6C\x24\x00\x48\x81\xEC\x00\x00\x00\x00\x4C\x8B\xF1\x48\x89\x4D\x00\x33\xC0\x0F\x57\xC0\x0F\x11\x45\x00\x48\x89\x45\x00\x48\xC7\x45\x00\x00\x00\x00\x00\x88\x45\x00\x0F\x11\x45\x00\x48\x89\x45\x00\x48\xC7\x45\x00\x00\x00\x00\x00\x88\x45\x00\xF3\x0F\x7F\x45\x00\x48\x89\x45\x00\x88\x45\x00\x48\x8D\x45\x00\x48\x89\x44\x24\x00\x48\x8D\x45\x00\x48\x89\x44\x24\x00\xC6\x44\x24\x00\x00\x48\x8D\x45\x00\x48\x89\x44\x24\x00\x48\x8D\x45\x00\x48\x89\x44\x24\x00\x4C\x8B\xCA\x4C\x8D\x05\x00\x00\x00\x00\x33\xD2")
    SPHR_DECL_API("v1_21_50,v1_21_60", "call", "\xE8\x00\x00\x00\x00\x90\x48\x8B\x54\x24\x00\x48\x83\xFA\x00\x76\x00\x48\xFF\xC2\x48\x8B\x4C\x24\x00\x48\x8B\xC1\x48\x81\xFA\x00\x00\x00\x00\x72\x00\x48\x83\xC2\x00\x48\x8B\x49\x00\x48\x2B\xC1\x48\x83\xC0\x00\x48\x83\xF8\x00\x76\x00\xFF\x15\x00\x00\x00\x00\xCC\xE8\x00\x00\x00\x00\x66\x0F\x6F\x05\x00\x00\x00\x00\xF3\x0F\x7F\x44\x24\x00\xC6\x44\x24\x00\x00\x48\x8B\x54\x24\x00\x48\x83\xFA\x00\x76\x00\x48\xFF\xC2\x48\x8B\x4C\x24\x00\x48\x8B\xC1\x48\x81\xFA\x00\x00\x00\x00\x72\x00\x48\x83\xC2\x00\x48\x8B\x49\x00\x48\x2B\xC1\x48\x83\xC0\x00\x48\x83\xF8\x00\x76\x00\xFF\x15\x00\x00\x00\x00\xCC\xE8\x00\x00\x00\x00\x48\x8B\x47")
    SDK_API static TextPacket createRaw(const std::string &raw);
};
static_assert(sizeof(TextPacket) == 256);